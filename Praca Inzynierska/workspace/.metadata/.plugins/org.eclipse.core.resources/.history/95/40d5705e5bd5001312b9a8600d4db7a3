package test.java.view;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.awt.event.ActionEvent;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.io.File;

import javax.swing.Box;
import javax.swing.BoxLayout;
import javax.swing.JButton;
import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JSplitPane;
import javax.swing.JTable;

import test.java.model.births.BirthsDatabase;
import test.java.model.chinchillas.Chinchila;
import test.java.model.chinchillas.ChinchillaDatabase;

public class TableView {
	// /testing
	public static void main(String[] args) {

		JFrame frame = new JFrame();
		BirthsDatabase db = new BirthsDatabase();
		ChinchillaDatabase ch = new ChinchillaDatabase();
		db.setChinchilaDatabase(ch);
		ch.loadXML(new File("chinchillas.xml"));
		db.loadXML(new File("db2.xml"));
		for (Chinchila chin : ch)
			System.out.println("DESC !!" + ch.indexOf(chin) + " "
					+ chin.getDescription());
		BirthsTableModel tableModel = new BirthsTableModel(db);

		JTable table = new JTable(tableModel);
		JTable table2 = new JTable(new ChinchillasTableModel(ch));
		frame.setLayout(new BorderLayout());

		JSplitPane center = new JSplitPane();
		center.setOrientation(JSplitPane.VERTICAL_SPLIT);

		JScrollPane northTable = new JScrollPane(table);
		JScrollPane southTable = new JScrollPane(table2);

		tableModel.addActionListener((ActionEvent arg0) -> {
			System.out.println("REVALIDATION");
			table2.tableChanged(null);
			center.invalidate();
		});
		System.out.println(tableModel.al.size());

		center.setLeftComponent(northTable);
		center.setRightComponent(southTable);
		JPanel west = new JPanel();
		west.setLayout(new BoxLayout(west, BoxLayout.Y_AXIS));

		JButton button = new JButton();
		button.setText("Dodaj urodziny");
		button.addActionListener((ActionEvent e) -> {
			db.createNewRecord();
			table.tableChanged(null);
		});
		west.add(button);
		
		button = new JButton();
		button.setText("Usun urodziny");
		button.addActionListener((ActionEvent e) -> {
			int row = table.getSelectedRow();
			db.remove(row);
			table.tableChanged(null);
		});
		west.add(button);

		
		west.add(Box.createRigidArea(new Dimension(2,50)));
		button = new JButton();
		button.setText("Dodaj szynszyla");
		button.addActionListener((ActionEvent e) -> {
			ch.createNewChinchila();
			table2.tableChanged(null);
		});
		west.add(button);

		button = new JButton();
		button.setText("Usun szynszyla");
		button.addActionListener((ActionEvent e) -> {
			int row = table.getSelectedRow();
			ch.remove(row);
			table2.tableChanged(null);
		});
		west.add(button);

	
		frame.add(west, BorderLayout.WEST);
		frame.add(center, BorderLayout.CENTER);
		frame.setSize(new Dimension (800,600));
		center.setResizeWeight(0.5);	
		frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
		frame.addWindowListener(new WindowAdapter() {
			@Override
			public void windowClosing(WindowEvent arg0) {
				db.saveXML(new File("db2.xml"));
				ch.saveXML(new File("chinchillas.xml"));
				super.windowClosing(arg0);
			}
		});
		frame.setVisible(true);
	}
}
